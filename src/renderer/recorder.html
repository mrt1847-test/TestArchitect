<!doctype html>
<html>
<head>
<meta charset="utf-8">
<link rel="stylesheet" href="../../record/style.css">
<link rel="stylesheet" href="lib/codemirror/lib/codemirror.css">
<link rel="stylesheet" href="lib/codemirror/theme/monokai.css">
<link rel="stylesheet" href="styles.css">
<style>
  /* VS Code 테마 변수 적용 */
  :root {
    --vscode-bg: #1e1e1e;
    --vscode-sidebar: #252526;
    --vscode-activity-bar: #2d2d30;
    --vscode-title-bar: #3c3c3c;
    --vscode-tab-bg: #1e1e1e;
    --vscode-tab-active: #2d2d30;
    --vscode-tab-border: #007acc;
    --vscode-border: #3e3e42;
    --vscode-text: #cccccc;
    --vscode-text-secondary: #858585;
    --vscode-hover: #2a2d2e;
    --vscode-selection: #264f78;
    --vscode-primary: #007acc;
    --vscode-primary-hover: #1a8cd8;
    --vscode-input-bg: #3c3c3c;
    --vscode-input-border: #454545;
  }

  body {
    min-width: 600px;
    min-height: 400px;
    margin: 0;
    padding: 8px;
    overflow-x: hidden;
    overflow-y: auto;
    box-sizing: border-box;
    background: var(--vscode-bg);
    color: var(--vscode-text);
    font-family: Inter, Arial, Helvetica, sans-serif;
  }
  
  html {
    height: 100%;
    overflow: visible;
    background: var(--vscode-bg);
  }
  
  #main {
    min-height: 400px;
    overflow-y: visible;
    display: flex;
    flex-direction: column;
    gap: 12px;
    align-items: stretch;
  }

  /* VS Code 다크 테마 오버라이드 */
  body {
    background: var(--vscode-bg) !important;
    color: var(--vscode-text) !important;
  }

  .toolbar {
    background: var(--vscode-sidebar) !important;
    border: 1px solid var(--vscode-border) !important;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3) !important;
  }

  .toolbar-row input,
  .toolbar-row textarea,
  .toolbar-row select {
    background: var(--vscode-input-bg) !important;
    border-color: var(--vscode-input-border) !important;
    color: var(--vscode-text) !important;
  }

  .toolbar-row input:focus,
  .toolbar-row textarea:focus,
  .toolbar-row select:focus {
    border-color: var(--vscode-primary) !important;
    box-shadow: 0 0 0 2px rgba(0, 122, 204, 0.18) !important;
  }

  .toolbar-btn {
    background: var(--vscode-input-bg) !important;
    border-color: var(--vscode-input-border) !important;
    color: var(--vscode-text) !important;
  }

  .toolbar-btn:hover:not(:disabled) {
    background: var(--vscode-hover) !important;
    border-color: var(--vscode-primary) !important;
  }

  .toolbar-btn.active {
    background: var(--vscode-primary) !important;
    color: white !important;
    border-color: var(--vscode-primary) !important;
  }

  .toolbar-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  .toolbar-label {
    color: var(--vscode-text-secondary) !important;
  }

  #timeline-panel,
  #selector-panel,
  #element-panel {
    background: var(--vscode-sidebar) !important;
    border-color: var(--vscode-border) !important;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2) !important;
  }

  #selector-panel {
    background: var(--vscode-sidebar) !important;
    border-radius: 8px;
    padding: 8px;
    border: 1px solid var(--vscode-border);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  #selector-panel h4 {
    margin: 0 0 8px 0;
    font-size: 15px;
    font-weight: 600;
    color: var(--vscode-text);
  }

  .panel-header h4 {
    color: var(--vscode-text) !important;
  }

  .timeline-item {
    background: var(--vscode-input-bg) !important;
    border-color: var(--vscode-border) !important;
    color: var(--vscode-text) !important;
  }

  .timeline-item:hover {
    background: var(--vscode-hover) !important;
  }

  .timeline-item.selected {
    background: var(--vscode-selection) !important;
    border-color: var(--vscode-primary) !important;
  }

  .selector-item {
    background: var(--vscode-input-bg) !important;
    border-color: var(--vscode-border) !important;
    color: var(--vscode-text) !important;
  }

  .selector-item.primary {
    background: rgba(0, 122, 204, 0.15) !important;
    border-color: var(--vscode-primary) !important;
  }

  .selector-item .selector-main .sel {
    color: var(--vscode-text) !important;
  }

  .selector-item .selector-main .type {
    background: rgba(0, 122, 204, 0.2) !important;
    color: var(--vscode-primary) !important;
  }

  #code-area {
    background: var(--vscode-sidebar) !important;
    border-color: var(--vscode-border) !important;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2) !important;
  }

  #code-area h4 {
    color: var(--vscode-text) !important;
  }

  #code-editor {
    background: var(--vscode-bg) !important;
    border-color: var(--vscode-border) !important;
  }

  #code-editor .CodeMirror {
    background: var(--vscode-bg) !important;
    color: var(--vscode-text) !important;
  }

  #code-editor .CodeMirror-gutters {
    background: var(--vscode-sidebar) !important;
    border-right-color: var(--vscode-border) !important;
  }

  #code-editor .CodeMirror-linenumber {
    color: var(--vscode-text-secondary) !important;
  }

  #replay-log {
    background: var(--vscode-sidebar) !important;
    border: 1px solid var(--vscode-border) !important;
    border-radius: 8px;
    padding: 12px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
  }

  #replay-log h4 {
    margin: 0 0 8px 0;
    font-size: 15px;
    font-weight: 600;
    color: var(--vscode-text);
  }

  #log-entries {
    background: var(--vscode-input-bg) !important;
    border-color: var(--vscode-border) !important;
    color: var(--vscode-text) !important;
    border-radius: 4px;
  }

  .log-entry {
    color: var(--vscode-text) !important;
  }

  .log-entry.log-info {
    color: var(--vscode-primary) !important;
  }

  .log-entry.log-success {
    color: #4ec9b0 !important;
  }

  .log-entry.log-error {
    color: #f48771 !important;
  }

  .action-menu {
    background: var(--vscode-sidebar) !important;
    border-color: var(--vscode-border) !important;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3) !important;
  }

  .action-menu button {
    color: var(--vscode-text) !important;
  }

  .action-menu button:hover {
    background: var(--vscode-hover) !important;
  }

  .action-menu-header {
    color: var(--vscode-text-secondary) !important;
    background: var(--vscode-input-bg) !important;
  }

  .element-section {
    color: var(--vscode-text) !important;
  }

  .element-title {
    color: var(--vscode-text-secondary) !important;
  }

  .element-action-buttons button {
    background: var(--vscode-input-bg) !important;
    border-color: var(--vscode-border) !important;
    color: var(--vscode-text) !important;
  }

  .element-action-buttons button:hover {
    background: var(--vscode-hover) !important;
    border-color: var(--vscode-primary) !important;
  }

  #iframe-banner {
    background: rgba(248, 113, 113, 0.15) !important;
    border-color: #f48771 !important;
    color: #f48771 !important;
  }

  .selector-empty {
    color: var(--vscode-text-secondary) !important;
    background: var(--vscode-input-bg) !important;
    border-color: var(--vscode-border) !important;
  }

  .code-review-summary {
    background: var(--vscode-input-bg) !important;
    border-color: var(--vscode-border) !important;
    color: var(--vscode-text) !important;
  }

  .code-review-diff {
    background: #0f172a !important;
    border-color: var(--vscode-border) !important;
  }

  .code-review-status {
    color: var(--vscode-text-secondary) !important;
  }

  .code-review-status.info {
    color: var(--vscode-primary) !important;
  }

  .code-review-status.success {
    color: #4ec9b0 !important;
  }

  .code-review-status.error {
    color: #f48771 !important;
  }

  .ai-settings-status {
    color: var(--vscode-text-secondary) !important;
  }

  .ai-settings-status.success {
    color: #4ec9b0 !important;
  }

  .ai-settings-status.error {
    color: #f48771 !important;
  }

  .ai-settings-status.pending {
    color: var(--vscode-primary) !important;
  }

  /* selector-panel 스타일 개선 */
  #selector-panel {
    flex: 1 1 auto;
    min-height: 200px;
  }

  #selector-list {
    flex: 1 1 auto;
    overflow-y: auto;
    min-height: 0;
  }

  /* selector-tab 스타일 다크 테마 적용 */
  .selector-tab-button {
    background: var(--vscode-input-bg) !important;
    border-color: var(--vscode-border) !important;
    color: var(--vscode-text) !important;
  }

  .selector-tab-button:hover:not(:disabled) {
    background: var(--vscode-hover) !important;
    border-color: var(--vscode-primary) !important;
  }

  .selector-tab-button.active {
    background: var(--vscode-primary) !important;
    color: white !important;
    border-color: var(--vscode-primary) !important;
  }

  /* selector-ai-control 스타일 다크 테마 적용 */
  .selector-ai-control {
    background: var(--vscode-input-bg) !important;
    border-color: var(--vscode-border) !important;
  }

  .selector-ai-title {
    color: var(--vscode-text) !important;
  }

  .selector-ai-button {
    background: var(--vscode-primary) !important;
    border-color: var(--vscode-primary) !important;
    color: white !important;
  }

  .selector-ai-button:hover:not(:disabled) {
    background: var(--vscode-primary-hover) !important;
  }

  .selector-ai-button.ghost {
    background: var(--vscode-input-bg) !important;
    color: var(--vscode-text) !important;
    border-color: var(--vscode-border) !important;
  }

  .selector-ai-button.ghost:hover:not(:disabled) {
    background: var(--vscode-hover) !important;
  }

  /* element-panel 스타일 개선 */
  #element-panel {
    background: var(--vscode-sidebar) !important;
    border-color: var(--vscode-border) !important;
  }

  .element-header h4 {
    color: var(--vscode-text) !important;
  }

  #element-cancel-btn {
    background: var(--vscode-input-bg) !important;
    border-color: var(--vscode-border) !important;
    color: var(--vscode-text) !important;
  }

  #element-cancel-btn:hover {
    background: var(--vscode-hover) !important;
  }

  #element-candidates {
    background: var(--vscode-input-bg) !important;
    border-color: var(--vscode-border) !important;
  }

  .element-path-item {
    background: var(--vscode-input-bg) !important;
    border-color: var(--vscode-border) !important;
    color: var(--vscode-text) !important;
  }

  .element-path-item .label {
    color: var(--vscode-primary) !important;
  }

  #element-attribute-panel input,
  #wait-time-input {
    background: var(--vscode-input-bg) !important;
    border-color: var(--vscode-border) !important;
    color: var(--vscode-text) !important;
  }

  #element-attr-apply,
  #wait-time-apply {
    background: var(--vscode-primary) !important;
    border-color: var(--vscode-primary) !important;
    color: white !important;
  }

  #element-attr-apply:hover,
  #wait-time-apply:hover {
    background: var(--vscode-primary-hover) !important;
  }

  #element-code-preview pre {
    background: var(--vscode-bg) !important;
    color: var(--vscode-text) !important;
    border: 1px solid var(--vscode-border) !important;
  }

  /* panel-mini-btn 스타일 */
  .panel-mini-btn {
    background: var(--vscode-input-bg) !important;
    border-color: var(--vscode-border) !important;
    color: var(--vscode-text) !important;
  }

  .panel-mini-btn:hover:not(:disabled) {
    background: var(--vscode-hover) !important;
    border-color: var(--vscode-primary) !important;
  }
</style>
</head>
<body>
  <div class="toolbar">
    <div class="toolbar-inner">
      <div class="toolbar-row">
        <label class="toolbar-field" for="test-purpose">
          <span class="toolbar-label">테스트 케이스</span>
          <textarea id="test-purpose" placeholder="테스트 케이스를 입력하세요" rows="3"></textarea>
        </label>
      </div>
      <div class="toolbar-row">
        <label class="toolbar-field" for="test-url">
          <span class="toolbar-label">테스트 URL (선택)</span>
          <input id="test-url" placeholder="https://example.com"/>
        </label>
      </div>
      <div class="toolbar-row">
        <label class="toolbar-field" for="tc-id-input">
          <span class="toolbar-label">TC ID *</span>
          <input id="tc-id-input" type="number" placeholder="123" min="1" required/>
        </label>
        <label class="toolbar-field" for="project-id-input">
          <span class="toolbar-label">Project ID</span>
          <input id="project-id-input" type="number" placeholder="1" min="1" value="1"/>
        </label>
        <div class="toolbar-field">
          <button id="send-recording-btn" class="toolbar-btn">TestArchitect로 전송</button>
        </div>
      </div>
      <div class="toolbar-row ai-config">
        <label class="toolbar-field" for="ai-endpoint">
          <span class="toolbar-label">AI Selector API Endpoint</span>
          <input id="ai-endpoint" placeholder="https://api.example.com/selectors" autocomplete="off" />
        </label>
        <label class="toolbar-field" for="ai-api-key">
          <span class="toolbar-label">AI API 키</span>
          <input id="ai-api-key" type="password" placeholder="API 키를 입력하세요" autocomplete="off" />
        </label>
        <label class="toolbar-field" for="ai-model">
          <span class="toolbar-label">AI 모델 (선택)</span>
          <input id="ai-model" placeholder="예: gpt-4.1-mini" autocomplete="off" />
        </label>
        <div class="toolbar-field ai-config-actions">
          <span class="toolbar-label">AI 설정</span>
          <button id="ai-settings-save" class="toolbar-btn">저장</button>
          <span id="ai-settings-status" class="ai-settings-status"></span>
        </div>
      </div>
      <div class="toolbar-row selects" role="group" aria-label="환경 설정">
        <label class="toolbar-field" for="framework-select">
          <span class="toolbar-label">자동화 프레임워크</span>
          <select id="framework-select">
            <option value="playwright">Playwright</option>
            <option value="selenium">Selenium</option>
            <option value="cypress">Cypress</option>
          </select>
        </label>
        <label class="toolbar-field" for="language-select">
          <span class="toolbar-label">언어</span>
          <select id="language-select">
            <option value="python">Python</option>
            <option value="python-class">Python (Class)</option>
            <option value="javascript">JavaScript</option>
            <option value="typescript">TypeScript</option>
          </select>
        </label>
      </div>
      <div class="toolbar-row buttons" role="group" aria-label="녹화 및 편집 작업">
        <button id="start-record" class="toolbar-btn">Record Start</button>
        <button id="stop-record" class="toolbar-btn" disabled>Stop</button>
        <button id="replay-btn" class="toolbar-btn">Replay</button>
        <button id="element-select-btn" class="toolbar-btn">요소 선택</button>
        <div class="action-menu-wrapper">
          <button id="action-btn" class="toolbar-btn">Action 추가 ▼</button>
          <div id="action-menu" class="action-menu hidden">
            <div class="action-menu-category">
              <div class="action-menu-header">상호작용</div>
              <button data-action-type="interaction" data-action="click">클릭</button>
              <button data-action-type="interaction" data-action="doubleClick">더블 클릭</button>
              <button data-action-type="interaction" data-action="rightClick">우클릭</button>
              <button data-action-type="interaction" data-action="hover">호버</button>
              <button data-action-type="interaction" data-action="type">입력</button>
              <button data-action-type="interaction" data-action="clear">입력 필드 비우기</button>
              <button data-action-type="interaction" data-action="select">드롭다운 선택</button>
            </div>
            <div class="action-menu-category">
              <div class="action-menu-header">검증</div>
              <button data-action-type="verify" data-action="verifyText">텍스트 검증</button>
              <button data-action-type="verify" data-action="verifyElementPresent">요소 존재 검증</button>
              <button data-action-type="verify" data-action="verifyElementNotPresent">요소 부재 검증</button>
              <button data-action-type="verify" data-action="verifyTitle">타이틀 검증</button>
              <button data-action-type="verify" data-action="verifyUrl">URL 검증</button>
            </div>
            <div class="action-menu-category">
              <div class="action-menu-header">대기</div>
              <button data-action-type="wait" data-action="waitForElement">요소 대기</button>
              <button data-action-type="wait" data-action="wait">시간 대기</button>
            </div>
          </div>
        </div>
        <button id="overlay-toggle-btn" class="toolbar-btn" aria-pressed="false">오버레이 표시</button>
        <button id="reset-btn" class="toolbar-btn">초기화</button>
      </div>
    </div>
  </div>

  <div id="main">
    <div id="main-top">
      <div id="timeline-panel">
        <div class="panel-header">
          <h4>Timeline</h4>
          <button id="delete-event-btn" class="panel-mini-btn" disabled>선택 삭제</button>
        </div>
        <div id="timeline"></div>
      </div>
      <div id="selector-column">
        <div id="iframe-banner" class="hidden">⚠️ 이 요소는 iframe 내부에 있습니다. 자동 전환 필요</div>
        <div id="selector-panel">
          <h4>추천 셀렉터</h4>
          <div id="selector-list"></div>
        </div>
        <div id="element-panel" class="hidden">
          <div class="element-header">
            <h4>요소 선택 흐름</h4>
            <button id="element-cancel-btn">취소</button>
          </div>
          <div id="element-status"></div>
          <div id="element-path" class="element-section hidden">
            <div class="element-title">선택 경로</div>
            <div id="element-path-items"></div>
          </div>
          <div id="element-candidates" class="element-section"></div>
          <div id="element-actions" class="element-section hidden">
            <div class="element-title">동작 선택</div>
            <div class="element-action-buttons">
              <button data-action="click">클릭 이벤트 추가</button>
              <button data-action="text">텍스트 가져오기</button>
              <button data-action="value">값(value) 가져오기</button>
              <button data-action="attribute">속성 가져오기</button>
              <button data-action="child">하위 노드 선택</button>
              <button data-action="parent">상위 노드로 이동</button>
              <button data-action="commit">선택 완료</button>
              <button data-action="finish">선택 취소</button>
            </div>
          </div>
          <div id="interaction-actions" class="element-section hidden">
            <div class="element-title">상호작용 액션</div>
            <div class="element-action-buttons">
              <button data-interaction="click">클릭</button>
              <button data-interaction="doubleClick">더블 클릭</button>
              <button data-interaction="rightClick">우클릭</button>
              <button data-interaction="hover">호버</button>
              <button data-interaction="type">입력</button>
              <button data-interaction="clear">입력 필드 비우기</button>
              <button data-interaction="select">드롭다운 선택</button>
            </div>
          </div>
          <div id="verify-actions" class="element-section hidden">
            <div class="element-title">검증 액션</div>
            <div class="element-action-buttons">
              <button data-verify="verifyText">텍스트 검증</button>
              <button data-verify="verifyElementPresent">요소 존재 검증</button>
              <button data-verify="verifyElementNotPresent">요소 부재 검증</button>
              <button data-verify="verifyTitle">타이틀 검증</button>
              <button data-verify="verifyUrl">URL 검증</button>
            </div>
          </div>
          <div id="wait-actions" class="element-section hidden">
            <div class="element-title">대기 액션</div>
            <div class="element-action-buttons">
              <button data-wait="waitForElement">요소 대기</button>
              <button data-wait="wait">시간 대기</button>
            </div>
            <div id="wait-input-panel" class="element-section hidden">
              <div class="element-title">대기 시간 (밀리초)</div>
              <div class="element-attr-row">
                <input id="wait-time-input" type="number" placeholder="2000" min="0" />
                <button id="wait-time-apply">적용</button>
              </div>
            </div>
          </div>
          <div id="element-attribute-panel" class="element-section hidden">
            <div class="element-title">속성 추출</div>
            <div class="element-attr-row">
              <input id="element-attr-name" placeholder="속성명 (예: href)" />
              <button id="element-attr-apply">적용</button>
            </div>
          </div>
          <div id="element-code-preview" class="element-section hidden">
            <div class="element-title">현재 코드 미리보기</div>
            <pre><code id="element-code"></code></pre>
          </div>
        </div>
      </div>
    </div>
      <div id="code-area">
      <div class="code-area-header">
        <h4>Code Preview</h4>
        <div class="code-review-controls">
          <span id="ai-review-btn-wrapper" class="ai-review-btn-wrapper">
            <button id="ai-review-btn" class="toolbar-btn">AI 검토</button>
          </span>
          <span id="ai-review-help" class="ai-review-help" role="button" aria-label="AI 검토 기능 안내" tabindex="0" aria-haspopup="true">!</span>
          <span id="ai-review-status" class="code-review-status"></span>
        </div>
      </div>
      <div id="code-editor">
        <textarea id="code-output" spellcheck="false" wrap="off"></textarea>
      </div>
      <div id="code-review-summary" class="code-review-summary hidden"></div>
      <div id="code-review-diff" class="code-review-diff hidden"></div>
    </div>
    <div id="replay-log"><h4>Replay Log</h4><div id="log-entries"></div></div>
  </div>

<script src="lib/codemirror/lib/codemirror.js"></script>
<script src="lib/codemirror/mode/javascript/javascript.js"></script>
<script src="lib/codemirror/mode/python/python.js"></script>
<script type="module" src="recorder.js"></script>
</body>
</html>
